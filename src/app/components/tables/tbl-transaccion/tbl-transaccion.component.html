<mat-progress-bar *ngIf="loading" mode="indeterminate" class="mx-n9 position-absolute"></mat-progress-bar>

<div class="table-responsive end-0" >

  <table #tabla mat-table [dataSource]="dataSource" matSort class="w-100 nowrap muted">

    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef width="50">
        <div class="form-check form-check-sm form-check-custom form-check-solid">
          <input class="form-check-input" type="checkbox"
                 (change)="$event ? masterToggle() : null"
                 [checked]="selection.hasValue() && isAllSelected()"
                 [indeterminate]="selection.hasValue() && !isAllSelected()">
        </div>
      </th>
      <td mat-cell *matCellDef="let row">
        <div class="form-check form-check-sm form-check-custom form-check-solid">
          <input class="form-check-input" type="checkbox"
                 (click)="$event.stopPropagation()"
                 (change)="$event ? selection.toggle(row) : null"
                 [checked]="selection.isSelected(row)">
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header width="50"> ID </th>
      <td mat-cell *matCellDef="let element"> {{element.id}} </td>
    </ng-container>

    <ng-container matColumnDef="tipoTransaccion">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> Tipo Transacci√≥n </th>
      <td mat-cell *matCellDef="let element"> {{element.tipoTransaccion}} </td>
    </ng-container>

    <ng-container matColumnDef="sedeOrigen">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> Sede Origen </th>
      <td mat-cell *matCellDef="let element"> {{element.sedeOrigen}} </td>
    </ng-container>

    <ng-container matColumnDef="sedeDestino">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> Sede Destino </th>
      <td mat-cell *matCellDef="let element"> {{element.sedeDestino}} </td>
    </ng-container>

    <ng-container matColumnDef="ordenCompra">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> Orden Compra </th>
      <td mat-cell *matCellDef="let element">{{ element.idOrdenCompra }}</td>
    </ng-container>

    <ng-container matColumnDef="fechaRegistro">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> F. Registro </th>
      <td mat-cell *matCellDef="let element">
        <span class="d-block small">{{element.fechaRegistro | date: 'dd-MM-yyyy hh:mm:ss aa'}}</span>
        <span class="d-block small">{{ element.usuarioRegistro }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="fechaModifico">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> F. Modifico </th>
      <td mat-cell *matCellDef="let element">
        <span class="d-block small">{{element.fechaModifico | date: 'dd-MM-yyyy hh:mm:ss aa'}}</span>
        <span class="d-block small">{{ element.usuarioModifico }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell mat-sort-header *matHeaderCellDef> Estado </th>
      <td mat-cell *matCellDef="let element">
        <span class="badge py-3 px-4 fs-8 f-w-500" [ngClass]="{'badge-light-warning': element.idEstado === EstadoTransaccion.Pendiente, 'badge-light-primary': element.idEstado === EstadoTransaccion.Confirmado, 'badge-light-danger' : element.idEstado === EstadoTransaccion.Anulado }">{{ element.estado }}</span>
      </td>
    </ng-container>


    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef width="50"> Acciones </th>
      <td mat-cell *matCellDef="let element">
        <div class="d-flex justify-content-end flex-shrink-0">
          <button matRipple class="btn btn-icon btn-bg-light btn-active-color-success btn-sm me-1" (click)="show(element)" tooltip="Ver">
            <span class="svg-icon svg-icon-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 576 512">
                <path fill="currentColor" opacity=".3" d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288.14 400H288a143.93 143.93 0 1 1 .14 0z"/>
                <path fill="currentColor" d="M380.66 280.87a95.78 95.78 0 1 1-184.87-50.18 47.85 47.85 0 0 0 66.9-66.9 95.3 95.3 0 0 1 118 117.08z"/>
              </svg>
            </span>
          </button>
          <button [disabled]="[EstadoTransaccion.Anulado, EstadoTransaccion.Confirmado].includes(element.idEstado)" matRipple class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1" (click)="confirm(element)" tooltip="Confirmar">
            <span class="svg-icon svg-icon-3">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" width="24" height="24">
                <path fill="currentColor" opacity=".3" d="M207.42,334.76c1.68,27.79,8.04,54.3,18.34,78.76h-95.31l37.5,34.12c11.85,11.21,12.36,29.91,1.14,41.75-.19,.2-.37,.39-.56,.58l-13.3,13.38c-11.53,11.53-30.23,11.53-41.77,0L11.54,401.99c-15.38-15.38-15.38-40.31,0-55.69h0l101.92-101.37c11.53-11.53,30.23-11.53,41.77,0l13.38,13.38c11.53,11.53,11.54,30.23,0,41.77-.19,.19-.38,.38-.58,.56l-37.57,34.12h76.97Zm240.58-206.76c-106.06,0-192,85.94-192,192s85.94,192,192,192,192-85.94,192-192-85.94-192-192-192Z"/>
                <path fill="currentColor" d="M253.75,177.24H29.53C13.22,177.24,0,164.02,0,147.71v-19.69C0,111.71,13.22,98.48,29.53,98.48H352.75c-39.63,17.06-73.75,44.44-99.01,78.76Zm371.56-20.64c8.11-14.93,5.86-34-6.77-46.63L516.62,8.65c-11.53-11.53-30.23-11.53-41.77,0l-13.34,13.38c-.19,.19-.38,.38-.56,.58-11.21,11.85-10.7,30.54,1.14,41.75l18.41,16.74c57,7.67,107.68,35.24,144.81,75.51Zm-199.52,252.14c-4.84,4.83-12.68,4.83-17.51,0l-80.52-80.52c-4.83-4.84-4.83-12.68,0-17.51l17.51-17.52c4.84-4.84,12.68-4.84,17.52,0h0l54.24,54.24,116.18-116.18c4.84-4.84,12.68-4.84,17.52,0h0l17.51,17.52c4.83,4.84,4.83,12.68,0,17.51l-142.45,142.45Z"/>
              </svg>
            </span>
          </button>
          <button [disabled]="[EstadoTransaccion.Anulado].includes(element.idEstado)" matRipple class="btn btn-icon btn-bg-light btn-active-color-danger btn-sm" (click)="cancel(element)" tooltip="Anular">
            <span class="svg-icon svg-icon-3">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" width="24" height="24" fill="none">
                <path fill="currentColor" opacity=".3" d="M207.42,334.76c1.68,27.79,8.04,54.3,18.34,78.76h-95.31l37.5,34.12c11.85,11.21,12.36,29.91,1.14,41.75-.19,.2-.37,.39-.56,.58l-13.3,13.38c-11.53,11.53-30.23,11.53-41.77,0L11.54,401.99c-15.38-15.38-15.38-40.31,0-55.69h0l101.92-101.37c11.53-11.53,30.23-11.53,41.77,0l13.38,13.38c11.53,11.53,11.54,30.23,0,41.77-.19,.19-.38,.38-.58,.56l-37.57,34.12h76.97Zm432.58-14.76c0,106.06-85.94,192-192,192s-192-85.94-192-192,85.94-192,192-192,192,85.94,192,192Z"/>
                <path fill="currentColor" d="M253.75,177.24H29.53C13.22,177.24,0,164.02,0,147.71v-19.69C0,111.71,13.22,98.48,29.53,98.48H352.75c-39.63,17.06-73.75,44.44-99.01,78.76Zm371.56-20.64c8.11-14.93,5.86-34-6.77-46.63L516.62,8.65c-11.53-11.53-30.23-11.53-41.77,0l-13.34,13.38c-.19,.19-.38,.38-.56,.58-11.21,11.85-10.7,30.54,1.14,41.75l18.41,16.74c57,7.67,107.68,35.24,144.81,75.51Zm-133.95,163.4l50.86-50.32,.02-.02c3.62-3.63,3.61-9.52-.02-13.14l-30.66-30.66-.02-.02c-3.63-3.62-9.52-3.61-13.14,.02l-50.4,50.79-50.32-50.86-.02-.02c-3.63-3.62-9.52-3.61-13.14,.02l-30.66,30.66-.02,.02c-3.62,3.63-3.61,9.52,.02,13.14l50.79,50.4-50.79,50.32-.02,.02c-3.62,3.63-3.61,9.52,.02,13.14l30.58,30.66,.02,.02c3.63,3.62,9.52,3.61,13.14-.02l50.4-50.79,50.32,50.79,.02,.02c3.63,3.62,9.52,3.61,13.14-.02l30.66-30.58,.02-.02c3.62-3.63,3.61-9.52-.02-13.14l-50.79-50.4Z"/>
              </svg>
            </span>
          </button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns;" [@slideFromBottom]="{value: '* <=> *',params : { delay: (i+1) * 50 }}" [class.bg-lighten]="selection.isSelected(row)" ></tr>

    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell text-muted small" [attr.colspan]="displayedColumns.length">No se encontraron registros</td>
    </tr>
  </table>

</div>

<mat-paginator class="bg-light" [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10"></mat-paginator>
